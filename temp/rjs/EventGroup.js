define(["require","exports"],function(){var e=function(){function e(t){this._id=e._uniqueId++,this._parent=t,this._eventRecords=[]}return e.prototype.dispose=function(){this.off(),this._parent=null},e.prototype.on=function(e,t,n){function r(){var e=n.apply(a,arguments);return e===!1&&arguments[0]&&arguments[0].preventDefault&&arguments[0].preventDefault(),e}var a=this._parent,s={target:e,eventName:t,parent:a,callback:n,elementCallback:null};e.__events=e.__events||{},e.__events[t]=e.__events[t]||{count:0},e.__events[t][this._id]=e.__events[t][this._id]||[],e.__events[t][this._id].push(s),e.__events[t].count++,e.addEventListener&&(s.elementCallback=r,e.addEventListener(t,r),"click"===t&&e.addEventListener("touchstart",r)),this._eventRecords.push(s)},e.prototype.off=function(e,t,n){for(var r=0;r<this._eventRecords.length;r++){var a=this._eventRecords[r];if(!(e&&e!==a.target||t&&t!==a.eventName||n&&n!==a.callback)){var s=a.target.__events[a.eventName],i=s[this._id];1!==i.length&&n?i.splice(i.indexOf(a),1):delete a.target.__events[a.eventName][this._id],--s.count||delete a.target.__events[a.eventName],a.target.removeEventListener&&(a.target.removeEventListener(a.eventName,a.elementCallback),"click"===t&&e.removeEventListener("touchstart",a.elementCallback)),this._eventRecords.splice(r,1)}}},e.prototype.raise=function(e,t,n){for(var r,a=this._parent;a&&r!==!1;){var s=a.__events?a.__events[e]:null;for(var i in s)for(var _=s[i],o=0;r!==!1&&o<_.length;o++){var v=_[o];r=v.callback.call(v.parent,t)}a=n?a.parent:null}return r},e.prototype.declare=function(e){var t=this._parent.__declaredEvents=this._parent.__declaredEvents||{};if("string"==typeof e)t[e]=!0;else for(var n=0;n<e.length;n++)t[e[n]]=!0},e.prototype.autoWire=function(t,n){t=t||this._parent,n="on"+(n||"");var r=this._parent.constructor.prototype;for(var a in r)if("function"==typeof r[a]&&0===a.indexOf(n)){var s=a.substr(n.length,1).toLowerCase()+a.substr(n.length+1);e.isDeclared(t,s)&&this.on(this._parent,s,this._parent[a])}},e.isObserved=function(e,t){return e&&e.__events&&e.__events[t]},e.isDeclared=function(e,t){return e&&e.__declaredEvents&&e.__declaredEvents[t]},e._uniqueId=0,e}();return e});