define(["require","exports"],function(){var e=function(){function e(t){this._id=e._uniqueId++,this._parent=t,this._eventRecords=[]}return e.prototype.dispose=function(){this.off(),this._parent=null},e.prototype.on=function(e,t,n){var r=this._parent,s={target:e,eventName:t,parent:r,callback:n};e.__events=e.__events||{},e.__events[t]=e.__events[t]||{count:0},e.__events[t][this._id]=e.__events[t][this._id]||[],e.__events[t][this._id].push(s),e.__events[t].count++,e.addEventListener&&e.addEventListener(t,function(){var e=n.apply(r,arguments);return e===!1&&arguments[0]&&arguments[0].preventDefault&&arguments[0].preventDefault(),e}),this._eventRecords.push(s)},e.prototype.off=function(e,t,n){for(var r=0;r<this._eventRecords.length;r++){var s=this._eventRecords[r];if(!(e&&e!==s.target||t&&t!==s.eventName||n&&n!==s.callback)){var a=s.target.__events[s.eventName],i=a[this._id];1!==i.length&&n?i.splice(i.indexOf(s),1):delete s.target.__events[s.eventName][this._id],--a.count||delete s.target.__events[s.eventName],s.target.removeEventListener&&s.target.removeEventListener(s.eventName,s.callback),this._eventRecords.splice(r,1)}}},e.prototype.raise=function(e,t,n){for(var r,s=this._parent;s&&r!==!1;){var a=s.__events?s.__events[e]:null;for(var i in a)for(var _=a[i],o=0;r!==!1&&o<_.length;o++){var v=_[o];r=v.callback.call(v.parent,t)}s=n?s.parent:null}return r},e.prototype.declare=function(e){var t=this._parent.__declaredEvents=this._parent.__declaredEvents||{};if("string"==typeof e)t[e]=!0;else for(var n=0;n<e.length;n++)t[e[n]]=!0},e.prototype.autoWire=function(t,n){t=t||this._parent,n="on"+(n||"");var r=this._parent.constructor.prototype;for(var s in r)if("function"==typeof r[s]&&0===s.indexOf(n)){var a=s.substr(n.length,1).toLowerCase()+s.substr(n.length+1);e.isDeclared(t,a)&&this.on(this._parent,a,this._parent[s])}},e.isObserved=function(e,t){return e&&e.__events&&e.__events[t]},e.isDeclared=function(e,t){return e&&e.__declaredEvents&&e.__declaredEvents[t]},e._uniqueId=0,e}();return e});