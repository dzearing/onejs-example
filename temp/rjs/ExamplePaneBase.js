var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);i.prototype=t.prototype,e.prototype=new i};define(["require","exports","View","TypeScriptGenerator"],function(e,t,i,o){var r=function(t){function i(){t.apply(this,arguments),this._editors={}}return __extends(i,t),i.prototype.onActivate=function(){this._findEditors(),this._initializeEditors()},i.prototype._findEditors=function(){function e(i){for(var o=0;o<i.length;o++){var r=i[o];if(r._subElements&&r._subElements.editor){var n=r._subElements.editor.getAttribute("data-key");t._editors[n]&&(t._editors[n].element=r._subElements.editor)}e(r.children)}}var t=this;t._editors={};for(var i=t.getViewModel().data.panes,o=0;o<i.length;o++){var r=i[o];r.hasEditor&&(t._editors[r.key]={pane:r,editor:null})}e(t.children)},i.prototype._initializeEditors=function(){var t=this;e(["ace"],function(){function e(){t._updateViewGeneration(),t._updateResult()}if(2==t._state){for(var i in t._editors){var o,r=t._editors[i];r.editor=o=ace.edit(r.element.id),o.getSession().setMode("ace/mode/"+r.pane.editorType),o.setValue(r.pane.content),r.pane.updatesResults&&o.getSession().on("change",e),o.clearSelection()}e()}})},i.prototype._updateViewGeneration=function(){var e=this._editors.viewtemplate;if(this._editors.html&&e){var t=new o,i=this._editors.html.editor.getValue();try{i=t.generate(i)}catch(r){i=r}i=i||"",e.editor.setValue(i),e.editor.clearSelection()}},i.prototype._updateResult=function(){var e=this._subElements.resultFrame.contentWindow.document;e.open();var t="<!doctype html>";t+="<html>",t+="<head>",t+="<style>",this._editors.less&&(t+=this._editors.less.editor.getValue()),t+="</style>",t+="</head>",t+="<body>",this._editors.html&&(t+=this._editors.html.editor.getValue()),t+="</body>",t+="</html>",e.write(t),e.close()},i}(i);return r});